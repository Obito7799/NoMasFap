<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Biblioteca personal digital premium para gestionar y leer tus libros favoritos">
    <title>Biblioteca Personal Premium | Mi Colección Digital</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
    <style>
        :root {
            --primary-color: #d53032;
            --primary-hover: #bf2c2e;
            --text-color: #2c3e50;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.00);
            --card-border: rgba(0, 0, 0, 0.06);
            --header-height: 80px;
            --premium-gradient: linear-gradient(135deg, #ffd700, #ffa500);
        }

        .dark-mode {
            --text-color: #ecf0f1;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --card-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Premium Access Form */
        .premium-access {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem auto;
            max-width: 500px;
            text-align: center;
            border: 1px solid var(--card-border);
            transition: all 0.3s ease;
        }

        .premium-access.hidden {
            display: none;
        }

        .premium-input {
            width: 100%;
            padding: 0.8rem;
            margin: 0.5rem 0;
            border: 1px solid var(--card-border);
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
        }

        /* Header Styles */
        header {
            position: fixed;
            width: 100%;
            z-index: 1000;
            top: 0;
            left: 0;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: var(--header-height);
            min-height: 60px;
            transition: all 0.3s ease;
            opacity: 1;
        }

        .header-content.fade-out {
            opacity: 0;
            transform: translateY(-20px);
        }

        .header-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: 700;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            opacity: 1;
        }

        .header-title.fade-out {
            opacity: 0;
            transform: translateY(-20px);
        }

        .header-nav {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        /* Rest of your existing styles... */
        /* [Previous CSS remains exactly the same] */

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Premium Access Form -->
    <div id="premiumAccess" class="premium-access">
        <h2>Activar Premium</h2>
        <input type="text" id="licenseKey" class="premium-input" placeholder="Ingresa tu código de licencia">
        <button onclick="activatePremium()" class="btn">
            <i class="fas fa-crown btn-icon"></i>
            Activar
        </button>
    </div>

    <header>
        <div class="header-content" id="headerContent">
            <h1 class="header-title" id="headerTitle">Mi Biblioteca</h1>
            <nav class="header-nav">
                <button class="btn" id="modeToggle">
                    <i class="fas fa-moon btn-icon"></i>
                    <span>Modo Oscuro</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- [Rest of your HTML remains exactly the same until the script tag] -->

    <script>
        // Variables para el control de licencias
        const validLicenses = ['X7J9L2A', 'Q5M4N1Z', 'P9T8R3K', 'H2V7X9F', 'W1Z5K6M'];
        const activeLicenses = new Map();
        let isPremiumActive = false;

        // Configuración de libros actualizada
        const books = {
            free: [
                {
                    title: "El arte de la guerra",
                    path: "Libros/El arte de la guerra - Sun Tzu.epub",
                    id: "arteguerra"
                },
                {
                    title: "Hábitos atómicos",
                    path: "Libros/James Clear - Hábitos atómicos (2019) - libgen.li.epub",
                    id: "habitos"
                }
            ],
            premium: [
                {
                    title: "Mentalidad de Titán",
                    path: "Libros/Mentalidad de Titán.epub",
                    id: "titan"
                },
                {
                    title: "Ragnarok: El camino de un hombre",
                    path: "Libros/Ragnarok. El camino de un hombre - Hombres Peligrosos.epub",
                    id: "ragnarok"
                },
                {
                    title: "Método ATENEA",
                    path: "Libros/Método ATENEA Guía de Autodefensa Contra Testimonios Engañosos y Alegaciones (Spanish Edition) - Alejandro Flores Maya.epub",
                    id: "atenea"
                },
                {
                    title: "Cómo ser más Masculino",
                    path: "Libros/Cómo ser más Masculino_ Descubre cómo transformarte en el hombre alfa que las mujeres desean y los demás respetan - Unknown.epub",
                    id: "masculino"
                }
            ]
        };

        // Función para activar premium
        async function activatePremium() {
            const licenseKey = document.getElementById('licenseKey').value.trim();
            
            if (!validLicenses.includes(licenseKey)) {
                alert('Licencia inválida');
                return;
            }

            if (activeLicenses.has(licenseKey)) {
                const lastAccess = activeLicenses.get(licenseKey);
                const now = Date.now();
                if (now - lastAccess < 1000 * 60 * 60) { // 1 hora de cooldown
                    alert('Esta licencia está en uso. Por favor, intenta más tarde.');
                    return;
                }
            }

            activeLicenses.set(licenseKey, Date.now());
            isPremiumActive = true;
            document.getElementById('premiumAccess').classList.add('hidden');
            alert('¡Bienvenido a Premium! Ahora tienes acceso a todo el contenido.');
            initializeLibrary(); // Reinicializar la biblioteca para actualizar los botones
        }

        // Modificar la función createBookCard para manejar contenido premium
        function createBookCard(bookData, isPremium = false) {
            const card = document.createElement('div');
            card.className = 'book-card';
            const buttonText = isPremium && !isPremiumActive ? 'Requiere Premium' : 'Leer Ahora';
            const buttonOnClick = isPremium && !isPremiumActive ? 
                'alert("Necesitas una suscripción premium para acceder a este contenido")' : 
                `openBook('${bookData.id}', '${bookData.title}')`;
            
            card.innerHTML = `
                <div class="book-cover" id="cover-${bookData.id}">
                    <img src="/api/placeholder/200/260" alt="${bookData.title}">
                </div>
                <div class="book-info">
                    <h3 class="book-title">${bookData.title}</h3>
                    <button onclick="${buttonOnClick}" class="btn">
                        <i class="fas fa-book-reader btn-icon"></i>
                        ${buttonText}
                    </button>
                </div>
            `;
            return card;
        }

        // Manejo del desvanecimiento de los controles del visor
        let controlsTimeout;
        function setupViewerControls() {
            const controls = document.querySelector('.viewer-controls');
            
            function showControls() {
                controls.style.opacity = '1';
                clearTimeout(controlsTimeout);
                controlsTimeout = setTimeout(() => {
                    controls.style.opacity = '0';
                }, 3000);
            }

            document.getElementById('bookViewer').addEventListener('click', showControls);
            document.getElementById('bookViewer').addEventListener('mousemove', showControls);
            
            // Iniciar el temporizador inicial
            showControls();
        }

        // Modificar la función openBook para configurar los controles
        const originalOpenBook = openBook;
        async function openBook(bookId, title) {
            if (books.premium.some(b => b.id === bookId) && !isPremiumActive) {
                alert('Necesitas una suscripción premium para acceder a este contenido');
                return;
            }
            
            await originalOpenBook(bookId, title);
            setupViewerControls();
        }

        // Manejo del desvanecimiento del header
        document.addEventListener('DOMContentLoaded', function() {
            const headerContent = document.getElementById('headerContent');
            const headerTitle = document.getElementById('headerTitle');
            const modeToggle = document.getElementById('modeToggle');
            let lastScrollPosition = 0;
            let ticking = false;

            function handleScroll() {
                const currentScroll = window.pageYOffset;
                
                if (currentScroll > 50) {
                    headerContent.classList.add('fade-out');
                    headerTitle.classList.add('fade-out');
                    modeToggle.classList.add('fade-out');
                } else {
                    headerContent.classList.remove('fade-out');
                    headerTitle.classList.remove('fade-out');
                    modeToggle.classList.remove('fade-out');
                }

                lastScrollPosition = currentScroll;
                ticking = false;
            }

            window.addEventListener('scroll', function() {
                if (!ticking) {
                    window.requestAnimationFrame(function() {
                        handleScroll();
                    });
                    ticking = true;
                }
            });
        });

        // [Rest of your JavaScript remains exactly the same]
        // [Include all previous functions without modification]

    </script>
</body>
</html>
